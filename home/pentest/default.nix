{ pkgs, ...}:

{
    # Allow unfree
    # nixpkgs.config.allowUnfree = true;
    home-manager = {
        users.tokugero = { pkgs, ... }: 
        {
            home = {
                packages = with pkgs; [
                    aircrack-ng
                    amass
                    binwalk
                    burpsuite
                    dirb
                    evil-winrm
                    exiftool
                    freerdp
                    gdb
                    ghidra
                    gobuster
                    hashcat
                    john
                    kismet
                    metasploit
		            proxychains
                    mimikatz
                    feroxbuster
                    net-snmp
                    netcat
                    nikto
                    nmap
                    freeradius
                    p7zip
                    pwndbg
                    pwntools
                    python312Packages.bloodyad
                    python312Packages.certipy-ad
                    python312Packages.impacket
                    radare2
                    rustscan
                    samba4Full
                    sherlock
                    smbmap
                    sqlcmd
                    sqlmap
                    steghide
                    tcpdump
                    thc-hydra
                    toybox
                    unzip
                    websocat
                    wireshark
                    wmic-bin
                    wordlists # wordlists_path
                    wsmancli
                    wpscan
                    zap
                ];
            };

        };
        useGlobalPkgs = true;
    };

    environment.systemPackages = with pkgs; [
        xrdp
    ];

    services.xrdp = {
        enable = true;
        defaultWindowManager = "startplasma-x11";

        extraConfDirCommands = ''
            substituteInPlace $out/xrdp.ini \
                --replace 'crypt_level=high' 'crypt_level=low' \
                --replace '#tcp_send_buffer_bytes=32768' 'tcp_send_buffer_bytes=4194304'
                
        '';
    };

    programs.zsh.loginShellInit = ''
        # if ~/.local/build already exists, pull - otherwise clone
        # git clone https://github.com/Tokugero/kali-build.git ~/.local/build/
        git -C ~/.local/build pull || git clone https://github.com/Tokugero/kali-build.git ~/.local/build/
    '';

    programs.zsh.interactiveShellInit = ''
        . ~/.local/build/aliases
    '';
}
